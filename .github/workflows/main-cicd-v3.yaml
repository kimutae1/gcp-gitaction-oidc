name: GCP 서비스 목록 조회

on:
  push:
    branches:
      - main

permissions:
  contents: 'read'
  id-token: 'write'

jobs:
  list-gcp-services:
    runs-on: ubuntu-latest
    steps:
     - name: 'GCP 인증'
       id: 'auth'
       uses: 'google-github-actions/auth@v2'
       with:
         workload_identity_provider: 'projects/132409220076/locations/global/workloadIdentityPools/github/providers/latimi2'
         service_account: 'kth-sa@storied-imprint-408506.iam.gserviceaccount.com'

 
     - name: 'env'
       run: |
          env
#CLOUDSDK_AUTH_CREDENTIAL_FILE_OVERRIDE: /home/runner/work/gcp-gitaction-oidc/gcp-gitaction-oidc/gha-creds-fd2047c6d557fb64.json
#GOOGLE_GHA_CREDS_PATH: /home/runner/work/gcp-gitaction-oidc/gcp-gitaction-oidc/gha-creds-fd2047c6d557fb64.json
#GOOGLE_APPLICATION_CREDENTIALS: /home/runner/work/gcp-gitaction-oidc/gcp-gitaction-oidc/gha-creds-fd2047c6d557fb64.json
     - name: '토큰좀 보자'
       run: |
        cat ${GOOGLE_APPLICATION_CREDENTIALS}
          echo "---------------------------------------------------------------------------------"
        cat ${CLOUDSDK_AUTH_CREDENTIAL_FILE_OVERRIDE}
          echo "---------------------------------------------------------------------------------"
        cat ${GOOGLE_GHA_CREDS_PATH}

          

     - name: 'GCP 서비스 목록 조회'
       run: |
         gcloud services list

#jobs:
#  oidc_debug_test:
#    permissions:
#      contents: read
#      id-token: write
#    runs-on: ubuntu-latest
#    steps:
#      - name: Checkout actions-oidc-debugger
#        uses: actions/checkout@v3
#        with:
#          repository: github/actions-oidc-debugger
#          ref: main
#          token: ${{ secrets.your-checkout-token }}
#          path: ./.github/actions/actions-oidc-debugger
#      - name: Debug OIDC Claims
#        uses: ./.github/actions/actions-oidc-debugger
#        with:
#          audience: '${{ github.server_url }}/${{ github.repository_owner }}'
